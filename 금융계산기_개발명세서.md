# 자동차 리스/렌트 금융계산기 개발 명세서

## 📌 프로젝트 개요

### 프로젝트명
**Financial Intelligence - 자동차 리스/렌트 월납입금 계산기**

### 목적
고객이 원하는 차량과 금융 조건을 선택하면, 각 금융사별로 정확한 월 납입금을 계산하여 제공하는 시스템 개발

### 핵심 목표
- **정확성**: 오차 없는 월납입금 계산
- **투명성**: 계산 과정을 상세히 공개하여 디버깅 및 검증 가능
- **최적화**: 기존 계산 로직을 개선하여 최적의 계산 모델 발견

---

## 🎯 서비스 흐름

```
1. 차량 선택
   ├─ 브랜드 선택 (예: 제네시스, BMW)
   ├─ 모델 선택 (예: G90, 3시리즈)
   └─ 등급 선택 (예: 3.5 터보)

2. 금융상품 선택
   ├─ 리스 (Lease)
   └─ 렌트 (Rent)

3. 계약 조건 설정
   ├─ 계약기간: 24/36/48/60개월
   ├─ 연간 주행거리
   │  ├─ 리스: 1만km / 2만km / 3만km / 4만km
   │  └─ 렌트: 1만km / 2만km / 3만km / 무제한
   └─ 보증금/선납금: 0% / 10% / 20% / 30%

4. 금융사별 월납입금 확인
   ├─ 일반 금융사 + 특판 통합 표시
   ├─ 가격 순 정렬
   └─ 상세 계산 과정 노출

5. 상담 신청 (프로토타입에서는 미구현)
```

---

## 📊 데이터 구조

### 1. 차량 정보 (carinfo.xlsx)
| 컬럼명 | 설명 | 예시 |
|--------|------|------|
| id_cargrade | 차량 등급 ID | 16238 |
| brand | 제조사 | BMW, 제네시스 |
| model | 모델명 | 3시리즈, G90 |
| grade | 등급 | 3.5 터보 |
| name | 차량 전체명 | - |
| price | 차량 가격 | 97,600,000 |
| fuel_type | 연료 타입 | 휘발유, 경유, 전기 |
| engine_size | 엔진 사이즈 (cc) | 1998 |
| body_style | 차체 스타일 | 세단, SUV, 해치백 |

**총 데이터**: 1,729개 차량

### 2. 차량 옵션 정보 (carinfo_option.xlsx)
| 컬럼명 | 설명 | 예시 |
|--------|------|------|
| id_cargrade | 차량 등급 ID | 17492 |
| id_cargrade_option | 옵션 ID | 74827 |
| name | 옵션명 | 세이프티 선루프 |
| price | 옵션 가격 | 520,000 |
| exclusive_index | 배타적 선택 인덱스 | 0, 1, 2 |

**총 데이터**: 11,101개 옵션
**참고**: 프로토타입에서는 옵션 선택 기능 제외 (옵션금액 = 0원)

### 3. 리스 견적 데이터 (lease.xlsx)

**시트 구성**: 16개 시트 (계약기간 × 주행거리)
- 24개월_1만km, 24개월_2만km, 24개월_3만km, 24개월_4만km
- 36개월_1만km, 36개월_2만km, 36개월_3만km, 36개월_4만km
- 48개월_1만km, 48개월_2만km, 48개월_3만km, 48개월_4만km
- 60개월_1만km, 60개월_2만km, 60개월_3만km, 60개월_4만km

**각 시트 구조**:
- 차량 기본 정보: 겟차번호, 모델, 제조사, 가격, 엔진cc, 연료, 국산/수입
- 금융사별 데이터 (1st, 2nd, 3rd, ... 반복):
  - **무보증 상품**
    - 회사명
    - 무보증월대여료옵션0 (옵션 0원 기준)
    - 무보증월대여료옵션500 (옵션 500만원 기준)
    - 무보증딜러오프셋
    - 무보증인수가격
    - 무보증Fee오프셋
    - 무보증1fee
  - **보증금 상품**
    - 회사명
    - 보증금월대여료옵션0
    - 보증금월대여료옵션500
    - 월대여료옵션0ref
    - 월대여료옵션500ref
    - 보증금딜러오프셋
    - 보증금인수가격
    - 보증금Fee오프셋
    - 보증금1fee
  - **선납금 상품**
    - 회사명
    - 선수금월대여료옵션0
    - 선수금월대여료옵션500
    - 월대여료옵션0ref
    - 월대여료옵션500ref
    - 선수금딜러오프셋
    - 선수금인수가격
    - 선수금Fee오프셋
    - 선수금1fee

### 4. 렌트 견적 데이터 (rent.xlsx)

**시트 구성**: 16개 시트 (계약기간 × 주행거리)
- 24개월_1만km, 24개월_2만km, 24개월_3만km, 24개월_무제한
- 36개월_1만km, 36개월_2만km, 36개월_3만km, 36개월_무제한
- 48개월_1만km, 48개월_2만km, 48개월_3만km, 48개월_무제한
- 60개월_1만km, 60개월_2만km, 60개월_3만km, 60개월_무제한

**데이터 구조**: 리스와 동일 (금융사명에 "특판_" 접두어 포함 가능)

---

## 🧮 계산 로직

### 프로토타입 고정 값
| 항목 | 값 | 설명 |
|------|-----|------|
| 옵션금액 | 0원 | 기본 차량 가격만 사용 |
| 딜러할인금액 | 0원 | 할인 없음 |
| 딜러Fee | 1% (0.01) | 고정 수수료 |

### 내부계산용 보증금/선납금 비율

#### 리스 (Lease)
```
선납금액 = (차량가격 + 옵션금액 - 딜러할인금액) × 선납비율 / 100
내부계산용선납금율 = 선납금액 / (차량가격 + 옵션금액) × 100

내부계산용보증금율 = 사용자 선택 보증금 비율 (그대로 사용)
```

**예시**:
- 차량가격: 1억원
- 옵션금액: 0원
- 딜러할인금액: 0원
- 사용자 선택 선납비율: 30%

→ 선납금액 = 1억 × 30 / 100 = 3천만원
→ 내부계산용선납금율 = 3천만 / 1억 × 100 = 30%

#### 렌트 (Rent)
```
내부계산용보증금율 = 사용자 선택 보증금 비율 (그대로 사용)
내부계산용선수금율 = 사용자 선택 선납 비율 (그대로 사용)
```

### 월납입금 계산식

#### 리스 (Lease)

**1. 무보증**
```
월납입금 = 무보증월대여료옵션0
         + (무보증월대여료옵션500 - 무보증월대여료옵션0) / 5000000 × (옵션금액 - 딜러할인금액)
         + 무보증1fee × 딜러Fee × (옵션금액 - 딜러할인금액 + 차량가격) / 차량가격
```

프로토타입 적용 시 (옵션금액=0, 딜러할인금액=0):
```
월납입금 = 무보증월대여료옵션0
         + 0
         + 무보증1fee × 0.01 × 차량가격 / 차량가격
         = 무보증월대여료옵션0 + 무보증1fee × 0.01
```

**2. 보증금**
```
월납입금 = 월대여료옵션0ref
         + (월대여료옵션500ref - 월대여료옵션0ref) / 5000000 × (옵션금액 - 딜러할인금액)
         + (보증금월대여료옵션0 - 월대여료옵션0ref) / 30 × (차량가격 + 옵션금액) / (차량가격 - 딜러할인금액 + 차량가격) × 내부계산용보증금율 × (옵션금액 - 딜러할인금액 + 차량가격) / 차량가격
         + 보증금1fee × 딜러Fee × (차량가격 + 옵션금액 - 딜러할인금액) / 차량가격
```

프로토타입 적용 시:
```
월납입금 = 월대여료옵션0ref
         + 0
         + (보증금월대여료옵션0 - 월대여료옵션0ref) / 30 × 내부계산용보증금율
         + 보증금1fee × 0.01
```

**3. 선납금**
```
월납입금 = 월대여료옵션0ref
         - (월대여료옵션0ref - 선수금월대여료옵션0) / 30 × 내부계산용선수금율
         + (월대여료옵션500ref - 월대여료옵션0ref) / 5000000 × 옵션금액 × (30 - 내부계산용선수금율) / 30
         + (선수금월대여료옵션500 - 선수금월대여료옵션0) / 5000000 / (30 - (30 - 내부계산용선수금율) / 30) / 옵션금액
         + 선수금Fee오프셋 × (옵션금액 + 차량가격) / 차량가격
         + 선수금1fee × 딜러Fee × (옵션금액 + 차량가격) / 차량가격
```

프로토타입 적용 시:
```
월납입금 = 월대여료옵션0ref
         - (월대여료옵션0ref - 선수금월대여료옵션0) / 30 × 내부계산용선수금율
         + 0
         + 0
         + 선수금Fee오프셋 (존재하는 경우)
         + 선수금1fee × 0.01
```

#### 렌트 (Rent)

**1. 무보증**
```
월납입금 = 무보증월대여료옵션0
         + (무보증월대여료옵션500 - 무보증월대여료옵션0) / 5000000 × (옵션금액 - 딜러할인금액)
         - 무보증딜러오프셋 × 딜러할인금액
         + 무보증Fee오프셋 × (옵션금액 + 차량가격) / 차량가격
         + 무보증1fee × 딜러Fee × (옵션금액 + 차량가격) / 차량가격
```

프로토타입 적용 시:
```
월납입금 = 무보증월대여료옵션0
         + 0
         - 0
         + 무보증Fee오프셋 (존재하는 경우)
         + 무보증1fee × 0.01
```

**2. 보증금**
```
월납입금 = 월대여료옵션0ref
         + (월대여료옵션500ref - 월대여료옵션0ref) / 5000000 × 옵션금액
         + (보증금월대여료옵션0 - 월대여료옵션0ref) / 30 × 내부계산용보증금율 × (차량가격 + 옵션금액) / 차량가격
         + 보증금Fee오프셋 × (차량가격 + 옵션금액) / 차량가격
         - 보증금딜러오프셋 × 딜러할인금액
         + 보증금1fee × 딜러Fee × (옵션금액 + 차량가격) / 차량가격
```

프로토타입 적용 시:
```
월납입금 = 월대여료옵션0ref
         + 0
         + (보증금월대여료옵션0 - 월대여료옵션0ref) / 30 × 내부계산용보증금율
         + 보증금Fee오프셋 (존재하는 경우)
         - 0
         + 보증금1fee × 0.01
```

**3. 선납금**
```
월납입금 = 월대여료옵션0ref
         - (월대여료옵션0ref - 선수금월대여료옵션0) / 0.3 × 내부계산용선수금율 / 100
         + (선수금월대여료옵션500 - 선수금월대여료옵션0) / 5000000 / 0.3 × (0.3 - (0.3 - 내부계산용선수금율 / 100)) / 옵션금액
         + (월대여료옵션500ref - 월대여료옵션0ref) / 5000000 × 옵션금액 × (0.3 - 내부계산용선수금율 / 100) / 0.3
         - 선수금딜러오프셋 × 딜러할인금액
         + 선수금Fee오프셋 × (옵션금액 + 차량가격) / 차량가격
         + 선수금1fee × 딜러Fee × (옵션금액 + 차량가격) / 차량가격
```

프로토타입 적용 시:
```
월납입금 = 월대여료옵션0ref
         - (월대여료옵션0ref - 선수금월대여료옵션0) / 0.3 × 내부계산용선수금율 / 100
         + 0
         + 0
         - 0
         + 선수금Fee오프셋 (존재하는 경우)
         + 선수금1fee × 0.01
```

### 옵션500 데이터의 활용

- **무보증월대여료옵션0**: 옵션 0원 기준 월대여료
- **무보증월대여료옵션500**: 옵션 500만원 기준 월대여료
- **목적**: 옵션 금액에 따른 월대여료 변화를 선형 보간하여 계산
- **프로토타입**: 옵션금액 = 0원이므로, "옵션0" 값을 주로 사용

---

## 🎨 UI/UX 설계

### 레이아웃: 3단 구조 (하이브리드)

```
┌──────────────────────────────────────────────────────────────┐
│                    헤더: Financial Intelligence              │
├─────────────┬──────────────────────┬─────────────────────────┤
│             │                      │                         │
│  좌측 영역   │      중앙 영역       │       우측 영역         │
│  (30%)      │      (35%)           │       (35%)             │
│             │                      │                         │
│  채팅 UI    │   선택 요약/결과     │   로직 상세 계산        │
│             │                      │                         │
│  - 차량 선택│   [선택한 차량]      │   [계산 과정]           │
│  - 조건 입력│   브랜드: 제네시스   │   1. 기준 월대여료      │
│  - 대화형   │   모델: G90          │   2. 옵션 가산액        │
│    인터페이스│   가격: 9,760만원   │   3. Fee 가산액         │
│             │                      │   4. 보증금 할인액      │
│             │   [금융 조건]        │   = 최종 월납입금       │
│             │   상품: 리스         │                         │
│             │   기간: 36개월       │   [금융사별 상세]       │
│             │   주행: 2만km        │   우리카드:             │
│             │   보증: 20%          │   - 무보증: 계산식...   │
│             │                      │   - 보증금: 계산식...   │
│             │   [월납입금 결과]    │                         │
│             │   1위. 우리카드      │   BNK캐피탈:            │
│             │      무보증 1,234,567│   - 무보증: 계산식...   │
│             │   2위. 특판_오릭스   │                         │
│             │      보증금 1,245,678│                         │
│             │   ...                │                         │
│             │                      │                         │
└─────────────┴──────────────────────┴─────────────────────────┘
```

### 좌측 영역: 채팅 UI

**특징**:
- 대화형 인터페이스
- 단계별 질문/응답
- 이전 선택 수정 가능
- 친근하고 직관적

**대화 흐름 예시**:
```
Bot: 어떤 차량을 찾고 계신가요? 브랜드를 선택해주세요.
     [제네시스] [BMW] [벤츠] [아우디] ...

User: [제네시스] 클릭

Bot: 제네시스 중 어떤 모델을 원하시나요?
     [G90] [GV80] [G80] ...

User: [G90] 클릭

Bot: G90의 등급을 선택해주세요.
     [3.5 터보] [3.5 터보 4인승] [3.5 터보 AWD] ...

User: [3.5 터보] 클릭

Bot: 선택하신 차량은 "제네시스 G90 3.5 터보"이며,
     차량가격은 97,600,000원입니다.
     리스와 렌트 중 어떤 상품을 원하시나요?
     [리스] [렌트]

User: [리스] 클릭

Bot: 계약기간은 얼마로 하시겠어요?
     [24개월] [36개월] [48개월] [60개월]

User: [36개월] 클릭

Bot: 연간 주행거리는 어느 정도 예상하시나요?
     [1만km] [2만km] [3만km] [4만km]

User: [2만km] 클릭

Bot: 보증금 또는 선납금을 설정하시겠어요?
     [무보증 (0%)] [10%] [20%] [30%]

User: [20%] 클릭 - 보증금으로 할지, 선납금으로 할지 선택

Bot: 20%를 어떻게 활용하시겠어요?
     [보증금 20%] [선납금 20%]

User: [보증금 20%] 클릭

Bot: 계산 중입니다... ✓
     중앙 패널에서 결과를 확인해주세요!
```

### 중앙 영역: 선택 요약 및 결과

**1. 선택 요약 섹션**
```
┌─────────────────────────┐
│  선택한 차량             │
├─────────────────────────┤
│ 브랜드: 제네시스         │
│ 모델: G90                │
│ 등급: 3.5 터보           │
│ 가격: 97,600,000원       │
└─────────────────────────┘

┌─────────────────────────┐
│  금융 조건               │
├─────────────────────────┤
│ 상품: 리스               │
│ 기간: 36개월             │
│ 주행: 연 2만km           │
│ 보증금: 20%              │
│  (19,520,000원)         │
└─────────────────────────┘
```

**2. 결과 섹션 (정렬: 가격 낮은 순)**
```
┌─────────────────────────────────────┐
│  월납입금 결과 (총 15개 금융사)      │
├──┬────────────┬──────────┬─────────┤
│순│ 금융사      │ 상품유형 │ 월납입금│
├──┼────────────┼──────────┼─────────┤
│1 │ 우리카드    │ 무보증   │1,234,567│
│2 │ 특판_오릭스 │ 보증금   │1,245,678│
│3 │ BNK캐피탈   │ 무보증   │1,256,789│
│4 │ 우리카드    │ 보증금   │1,267,890│
│5 │ 롯데캐피탈  │ 무보증   │1,278,901│
│  │ ...         │          │         │
└──┴────────────┴──────────┴─────────┘

[상담 신청하기] 버튼 (프로토타입: 비활성)
```

### 우측 영역: 로직 상세 계산

**금융사별 계산 과정 노출**

```
┌─────────────────────────────────────────┐
│  계산 과정 상세 (디버깅용)               │
├─────────────────────────────────────────┤
│                                         │
│ [1위] 우리카드 - 무보증                 │
│ ─────────────────────────────────────── │
│ ✓ 기본 정보                              │
│   - 무보증월대여료옵션0: 1,797,800원    │
│   - 무보증월대여료옵션500: 1,889,200원  │
│   - 무보증1fee: 44,970원                │
│                                         │
│ ✓ 계산식 적용                            │
│   월납입금 = 무보증월대여료옵션0         │
│            + (옵션500 - 옵션0)/5,000,000│
│              × (옵션금액 - 할인금액)     │
│            + 무보증1fee × 딜러Fee        │
│              × (옵션+차량가) / 차량가    │
│                                         │
│ ✓ 값 대입                                │
│   = 1,797,800                           │
│     + (1,889,200 - 1,797,800)/5,000,000 │
│       × (0 - 0)                         │
│     + 44,970 × 0.01                     │
│       × (0 + 97,600,000) / 97,600,000  │
│                                         │
│   = 1,797,800                           │
│     + 0                                 │
│     + 44,970 × 0.01 × 1                 │
│                                         │
│   = 1,797,800 + 449.7                   │
│   = 1,798,249.7원                       │
│   ≈ 1,798,250원 (반올림)                │
│                                         │
│ ─────────────────────────────────────── │
│                                         │
│ [2위] 특판_오릭스 - 보증금 20%          │
│ ─────────────────────────────────────── │
│ ✓ 기본 정보                              │
│   - 월대여료옵션0ref: 1,980,400원       │
│   - 보증금월대여료옵션0: 1,858,400원    │
│   - 보증금1fee: 45,000원                │
│   - 내부계산용보증금율: 20               │
│                                         │
│ ✓ 계산식 적용                            │
│   월납입금 = 월대여료옵션0ref            │
│            + (보증옵션0 - ref옵션0) / 30 │
│              × 내부계산용보증금율        │
│            + 보증금1fee × 0.01          │
│                                         │
│ ✓ 값 대입                                │
│   = 1,980,400                           │
│     + (1,858,400 - 1,980,400) / 30      │
│       × 20                              │
│     + 45,000 × 0.01                     │
│                                         │
│   = 1,980,400                           │
│     + (-122,000 / 30) × 20              │
│     + 450                               │
│                                         │
│   = 1,980,400                           │
│     + (-4,066.67) × 20                  │
│     + 450                               │
│                                         │
│   = 1,980,400 - 81,333.33 + 450         │
│   = 1,899,516.67원                      │
│   ≈ 1,899,517원 (반올림)                │
│                                         │
│ (계속 스크롤하여 모든 금융사 확인 가능)  │
└─────────────────────────────────────────┘
```

---

## 🛠 기술 스택

### 프론트엔드
- **Streamlit**: 빠른 프로토타이핑, 채팅 UI 구현
- **Python**: 3.9 이상

### 데이터 처리
- **pandas**: Excel 데이터 로드 및 처리
- **openpyxl**: Excel 파일 읽기

### 배포 (프로토타입 이후)
- Streamlit Cloud / Heroku / AWS

---

## 📂 프로젝트 구조

```
finance_intelligence/
├── ref/                           # 참고 데이터
│   ├── carinfo.xlsx
│   ├── carinfo_option.xlsx
│   ├── lease.xlsx
│   ├── rent.xlsx
│   └── 앱 노출 계산.md
│
├── src/                           # 소스 코드
│   ├── app.py                     # Streamlit 메인 앱
│   ├── data_loader.py             # 데이터 로드 모듈
│   ├── calculator.py              # 계산 로직 모듈
│   ├── ui/                        # UI 컴포넌트
│   │   ├── chat.py                # 채팅 UI
│   │   ├── summary.py             # 요약 패널
│   │   └── debug.py               # 디버깅 패널
│   └── utils.py                   # 유틸리티 함수
│
├── requirements.txt               # 패키지 의존성
├── README.md                      # 프로젝트 설명
└── 금융계산기_개발명세서.md       # 본 문서

```

---

## 🎯 개발 범위

### Phase 1: 프로토타입 (현재)

#### 구현 항목
- ✅ 차량 선택 UI (브랜드 → 모델 → 등급)
- ✅ 금융 조건 선택 (상품, 기간, 주행거리, 보증금/선납금)
- ✅ 월납입금 계산 로직 (정확성 최우선)
- ✅ 3단 레이아웃 (채팅 | 요약/결과 | 디버깅)
- ✅ 금융사별 상세 계산 과정 노출
- ✅ 일반 + 특판 통합 표시
- ✅ 가격 순 정렬

#### 제외 항목
- ❌ 차량 옵션 선택 (옵션금액 = 0원 고정)
- ❌ 딜러 할인 입력 (딜러할인금액 = 0원 고정)
- ❌ 상담 신청 기능 (버튼만 표시, 비활성)
- ❌ 데이터베이스 연동
- ❌ 실시간 데이터 업데이트
- ❌ 사용자 인증/로그인
- ❌ 12개월, 72개월 계약

#### 고정 설정값
| 항목 | 값 |
|------|-----|
| 옵션금액 | 0원 |
| 딜러할인금액 | 0원 |
| 딜러Fee | 1% (0.01) |

### Phase 2: 최적화 및 확장 (향후)
- 계산 로직 검증 및 최적화
- 옵션 선택 기능 추가
- 딜러 할인 및 Fee 동적 입력
- 상담 신청 API 연동
- 데이터베이스 연동
- 관리자 페이지 (데이터 업데이트 감지)
- 12개월, 72개월 계약 지원
- 모바일 최적화

---

## 🔍 핵심 요구사항

### 1. 정확성
- **오차 없는 계산**: 소수점 처리, 반올림 규칙 명확화
- **모든 금융사 데이터 반영**: 누락 없이 처리
- **계산 과정 검증 가능**: 우측 패널에서 단계별 확인

### 2. 투명성
- **계산 과정 공개**: 모든 변수와 계산식 노출
- **디버깅 용이**: 오류 발생 시 즉시 추적 가능
- **데이터 소스 명시**: 어떤 Excel 시트/행/열에서 가져왔는지

### 3. 최적화 지향
- **기존 로직은 참고용**: 더 나은 계산 방법 탐색
- **성능 측정**: 계산 시간 표시
- **로직 개선 제안**: 비효율적인 부분 식별 및 개선

---

## 📋 개발 체크리스트

### 데이터 로드
- [ ] carinfo.xlsx 읽기 (차량 정보)
- [ ] carinfo_option.xlsx 읽기 (옵션 정보, 미사용)
- [ ] lease.xlsx 전체 시트 읽기 (16개)
- [ ] rent.xlsx 전체 시트 읽기 (16개)
- [ ] 시트명 파싱 (계약기간, 주행거리 추출)
- [ ] 금융사 데이터 파싱 (1st, 2nd, 3rd, ...)

### 계산 로직
- [ ] 내부계산용 보증금/선납금 비율 계산
- [ ] 리스 - 무보증 월납입금 계산
- [ ] 리스 - 보증금 월납입금 계산
- [ ] 리스 - 선납금 월납입금 계산
- [ ] 렌트 - 무보증 월납입금 계산
- [ ] 렌트 - 보증금 월납입금 계산
- [ ] 렌트 - 선납금 월납입금 계산
- [ ] 계산 과정 로깅 (디버깅용)
- [ ] 결과 정렬 (가격 낮은 순)
- [ ] 특판 상품 통합 처리

### UI 구현
- [ ] 3단 레이아웃 구성
- [ ] 좌측: 채팅 UI
  - [ ] 브랜드 선택
  - [ ] 모델 선택
  - [ ] 등급 선택
  - [ ] 금융상품 선택 (리스/렌트)
  - [ ] 계약기간 선택
  - [ ] 주행거리 선택
  - [ ] 보증금/선납금 비율 선택
  - [ ] 보증금/선납금 구분 선택
- [ ] 중앙: 요약 및 결과
  - [ ] 선택한 차량 요약
  - [ ] 금융 조건 요약
  - [ ] 월납입금 결과 테이블
  - [ ] 상담 신청 버튼 (비활성)
- [ ] 우측: 디버깅 패널
  - [ ] 금융사별 계산 과정 표시
  - [ ] 변수 값 표시
  - [ ] 계산식 단계별 표시
  - [ ] 최종 결과 표시

### 테스트
- [ ] 샘플 차량 3개로 계산 검증
- [ ] 모든 계약기간 테스트 (24/36/48/60)
- [ ] 모든 주행거리 테스트
- [ ] 모든 보증금 비율 테스트 (0/10/20/30%)
- [ ] 보증금 vs 선납금 비교 테스트
- [ ] 특판 상품 포함 테스트
- [ ] 엣지 케이스 (데이터 없는 경우)

---

## 🚨 주의사항 및 제약

### 데이터 관련
1. **NaN 처리**: Excel에서 빈 값은 0으로 처리할지, 계산 제외할지 명확화 필요
2. **딜러오프셋, Fee오프셋**: 대부분 NaN → 0으로 처리
3. **특판 상품**: 회사명에 "특판_" 접두어 → 별도 표시 없이 통합

### 계산 관련
1. **반올림**: 원 단위 반올림 (최종 월납입금)
2. **음수 방지**: 계산 결과가 음수면 에러 로깅
3. **0으로 나누기**: 차량가격이 0인 경우 방지
4. **내부계산용 비율**: 리스와 렌트의 계산 방식 차이 주의

### UI 관련
1. **Streamlit 세션 상태**: 채팅 히스토리 유지
2. **3단 레이아웃**: Streamlit의 columns 활용
3. **스크롤**: 우측 디버깅 패널은 스크롤 가능하게
4. **성능**: 대량 데이터 로드 시 캐싱 활용 (`@st.cache_data`)

---

## 📊 예상 산출물

### 1. 메인 화면 (Streamlit 앱)
- 좌측: 대화형 차량/조건 선택
- 중앙: 요약 및 월납입금 순위
- 우측: 상세 계산 과정

### 2. 계산 결과 예시
```
┌─────────────────────────────────────────┐
│ 제네시스 G90 3.5 터보 (97,600,000원)    │
│ 리스 | 36개월 | 2만km | 보증금 20%      │
├──┬────────────┬──────────┬─────────────┤
│1 │ 우리카드    │ 무보증   │ 1,798,250원 │
│2 │ 특판_오릭스 │ 보증금   │ 1,899,517원 │
│3 │ BNK캐피탈   │ 무보증   │ 1,950,000원 │
│  │ ...         │          │             │
└──┴────────────┴──────────┴─────────────┘
```

### 3. 디버깅 로그 (우측 패널)
- 각 금융사의 원본 데이터
- 적용된 계산식
- 단계별 계산 결과
- 최종 월납입금

---

## 🔮 향후 확장 계획

### Phase 2: 기능 확장
- 차량 옵션 선택 기능
- 딜러 할인/Fee 동적 입력
- 상담 신청 API 연동
- 계산 결과 PDF/엑셀 다운로드
- 금융사 비교 차트/그래프

### Phase 3: 데이터 연동
- 실시간 금융사 데이터 업데이트
- 데이터 변경 감지 및 알림
- 관리자 페이지 (데이터 관리)
- 로그 및 분석 (인기 차량, 선호 조건)

### Phase 4: 고도화
- AI 기반 최적 조건 추천
- 사용자 맞춤형 금융 상품 제안
- 할부/일시불 비교 기능
- 모바일 앱 개발

---

## 📝 개발 우선순위

### 최우선 (P0)
1. 데이터 로드 및 파싱
2. 기본 계산 로직 구현 (무보증)
3. 채팅 UI 기본 흐름
4. 결과 표시 (중앙 패널)

### 우선 (P1)
5. 보증금/선납금 계산 로직
6. 디버깅 패널 (우측)
7. 특판 상품 통합
8. 가격 정렬 및 순위

### 일반 (P2)
9. UI 개선 (색상, 레이아웃)
10. 에러 처리 및 예외 상황
11. 테스트 케이스 작성
12. 성능 최적화 (캐싱)

---

## 🎓 참고 자료

### 계산 로직 원본
- `ref/앱 노출 계산.md`: 기존 계산식 정의

### 데이터 소스
- `ref/carinfo.xlsx`: 1,729개 차량 정보
- `ref/carinfo_option.xlsx`: 11,101개 옵션 정보 (미사용)
- `ref/lease.xlsx`: 리스 견적 (16개 시트)
- `ref/rent.xlsx`: 렌트 견적 (16개 시트)

### 기술 문서
- Streamlit 공식 문서: https://docs.streamlit.io
- pandas 공식 문서: https://pandas.pydata.org
- openpyxl 공식 문서: https://openpyxl.readthedocs.io

---

## 📞 문의 및 피드백

프로토타입 개발 중 질문이나 피드백이 있으면 언제든지 말씀해주세요.

---

**작성일**: 2025-10-29
**버전**: 1.0 (프로토타입 명세)
**상태**: 개발 준비 완료
